# Образы регионов на основе анализа эмоциональной тональности новостей

Репозиторий создан для хранения материалов выпускной квалификационной работы "Картографирование образа регионов на основе анализа тональности новостей" (Московский Государственный Университет имени М.В. Ломоносова, географический факультет,кафедра картографии и геоинформатики)

## Оглавление

- Обзор
- Особенности
- Установка
- Функции
- Результаты
- Лицензия
- Контакты

## Обзор

Целью работы является разработка методики автоматизированного сбора и анализа текстовых материалов СМИ для картографирования географических образов регионов. В качестве новостного ресурса рассматривается "Комсомольская правда". Особенностью ресурса является несоответствие "редакционных" регионов тем, которые записаны в Конституции Российской Федерации на момент окончания исследования (апрель 2024 года).

Для оценки тональности используются библиотеки NLTK и TextBlob. NLTK отличает простота использования и отсутствие обязательного дополнительного машинного обучения модели под свои задачи ― есть возможность использовать уже заранее обученную модель на наборе обзоров фильмов «Naive Bayes Analyzer» (наивный байесовский). 

Коды написаны на языке Python. Среда выполнения Jupyter Notebook.

## Особенности

- Автоматизация: автоматизирован сбор и анализ данных новостного ресурса с помощью парсинга.
- Картографирование: картографирование образов регионов с использованием анализа тональности.
- Визуализация: веб-карта, иллюстрирующая составленые образы регионов и результаты тональности по пяти тематическим категориям -  "Экономика", "Политика", "Общество", "Происшествия", "Спорт".

## Установка 
Для начала клонируйте этот репозиторий и установите необходимые зависимости:

git clone https://github.com/ArinaPupova/sentiment\_analysis\_regions.git

cd sentiment\_analysis\_regions

pip install -r requirements.txt

## Функции

В файле Jupiter Notebook "diploms_cods" хранятся написанные коды. Данные были собраны и обработаны в 3 этапа:

1 этап - Сбор ссылок на новости:
    Функции:
          - «create_folder» - создание папки с названием текущей даты в заданном базовом пути.  
          - «get_news_links» - получение HTML-содержимое веб-страницы региона и извлечение из него уникальных ссылрк на новости,                                        соответствующих определенному шаблону.  
          - «save_news_links» - сохранение списка ссылок на новости и текущую дату в CSV-файл с именем, содержащим регион.   
          - «main» - вызов других функций для каждого региона из списка region_url. Для каждого региона создается папка, извлекаются ссылки на новости, и                       они сохраняются в CSV-файл. Между обработкой регионов есть задержка в 15 секунд для избежания блокировки сервера.  
    После объявления всех функций вызывается конструкция «if name == 'main'», в которой хранится адрес базового пути сохранения данных, переменная, в которой хранится список регионов, а после вызывается главная функция.   

2 этап - Сбор текстовых материалов, тегов, перевод текста и проведение анализа тональности:  
    Функции:  
          - «create_folder_text» - создание папок для хранения текстов новостей и результатов анализа тональности.  
          - «extract_text_and_tags» - позволяет извлечь текст и тег новости, перейдя по ссылке.  
          - «translation_text» - перевод текста с русского на английский язык.  
          - «save_texts» создана - сохранение текстов новостей их переводов и тегов в CSV-файл.  
          - «sent_analysis» - анализ тональности переведенных текстов новостей.  
          - «main» ― вызов других функций для каждого региона из списка region_url. Создаются папки для хранения текстов новостей и результатов анализа.  
  Вызывается конструкция «if name == 'main'», в которой хранится адрес базового пути сохранения данных, переменная, в которой хранится список регионов, название папки ―   день сбора в формате дд_мм_гг, а после вызывается главная функция.   

3 этап - Приведение данных к виду, удобному для картографирования и счёт количества новостей  
    Функции:  
          - «process_region» - обработка данных для одного региона. Позволяет посчитать сколько новостей было по определённому тегу за один день, а также                                  считает среднее арифметическое выставленных значений позитивности и негативности.   
    Вызывается конструкция «if __name__ == '__main__'», задаются значения переменных и вызывается функция process_region для каждого региона из списка     регионов.  
          - «get_mean_by_month» - обработка csv-файлов, содержащих данные о тегах для разных регионов и разных месяцев.  
          - «convert_to_geojson» - объединение данных в формате Shapefile с данными из csv-файла и сохранение файла в формате GeoJSON.  
    После функции определяются списки, содержащие названия месяцев и тегов. Также задается путь к директории с данными. Затем считывается Shapefile. Далее идут два вложенных цикла, которые перебирают все комбинации месяцев и тегов. Для каждой комбинации формируются пути к файлу в формате csv и выходному GeoJSON-файлу, после чего вызывается функция convert_to_geojson для выполнения преобразования данных.  

Также были написаны вспомогательные коды, которые облегчают взаимодействие с данными или кодом в определенных ситуациях:  
1. Код прервался и необходимо найти индекс региона, который был последним.  
              -	Вручную ввести название последнего региона, бывшего в работе;  
              -	Выдается его индекс после поиска по списку регионов;  
2. Объединение содержимого всех GeoJSON файлов, содержащих образы регионов, в один файл в формате xslx.  

## Использование

В проекте используется набор идентификаторов страниц региональных новостей "Комсомольской правды". Перед началом работы необходимо скачать файл "all_regions.txt". 

## Результаты

В результате работы составлены картографические материалы по четырём месяц наблюдения - с декабря 2023 по март 2024 года (включительно). Визуализация результатов хранится по ссылке: [Карты] (https://arinapupova.github.io/sentiment_analysis_regions/#2/68.0/92.9.)

## Лицензия



## Контакты

По любым вопросам или предложениям обращайтесь к владельцу репозитория:

- Имя: Арина Пупова
- Адрес электронной почты: rinkapupova@gmail.com

